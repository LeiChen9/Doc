# 医学问答系统设计文档
goal：提供医学知识索引
scene：针对医学问题的背景知识补充，只做事实（目前被广泛认可的医学事实）阐述与溯源，不做观点、决策与建议输出。
feature：对用户提出的问题提供知识片段的索引与quote。
## 1. 知识库结构设计
知识库采用结构化设计，每条知识点记录包括以下字段：主题实体（疾病、症状、药物等）、原文（来源文献中的原句）、论点摘要（简要归纳）、来源出处（书名、章名等）、章节路径、标签、唯一ID 等；同时为每条记录生成语义向量。各记录应存储来源元数据，如文档名称、证据等级、发布日期、学科标签等，以构建完整的溯源链。
知识组织上，可先按教材/指南分卷（如“内科学卷”、“外科指南卷”），再按章节/主题划分。例如，可按《哈里森内科学》的章节提取“冠心病”“心力衰竭”等实体，并关联“病理机制”“临床表现”等属性。数据存储建议使用 PostgreSQL 数据库，表结构示例为 (id, entity, title, text, summary, source, chapter_path, tags, metadata, vector)；其中嵌入向量字段采用 pgvector 存储，保证事务一致性和检索效率。PostgreSQL + pgvector 已成为医学向量检索的首选方案，在百万级文档检索时延低至毫秒级。
## 2. 数据获取与更新机制
数据源应选取权威公开的医学资料，如国家/国际官方指南、经典教材、核心期刊、专家共识和药品说明书等。比如可整合中华医学会、国家心血管病中心等发布的指南，以及《希氏内科学》《默克诊疗手册》、国内外权威期刊文章等。
更新机制采用“半自动+人工审核”模式：通过爬虫接口定期抓取官网、出版机构或数据库的新版PDF/HTML文档，同时也支持用户/专家上传新文档。每次导入均记录批次号、来源ID、导入时间等元信息，并建立版本控制和审计日志。
系统自动化更新模块会连接新闻源、期刊库和公告平台，定时抓取、清洗并结构化新增内容，确保知识库“鲜活”。
对于重点资料（如指南），按发布周期（季度或月度）设置高频更新，其他资料低频同步更新；每次更新记录修改来源和影响范围，以便回溯和对账。
## 3. 非结构化资料处理设计
对采集的PDF/DOC文档按章节提取并切分：首先根据文档目录结构进行分段，再采用“标题–小节–表格”三级语义切分策略，将文档切成逻辑块。每个文本块均保留其章节号、页码等锚点信息，便于在回答中引用原文。
对表格、图表等特殊元素，采用规则匹配或专用组件（如 Camelot、unstructured 库）解析；提取的表格内容转换为结构化数组并关联原表头。切分后的文本块再进一步处理：可用NLP工具按句子或实体拆分，对药物名、医学术语等进行命名实体识别和归一化（引用医疗词典或UMLS）。同时应用正则表达式或模板抽取常见知识（如诊断标准、药物剂量、禁忌症），生成摘要和标签，最后由专业人员校对。整个过程保证每个知识单元的文本与对应元数据一致，方便后续检索和溯源。
## 4. 索引与检索机制设计
对知识库中每条记录建立关键词索引和向量索引：关键词索引包括实体名称、疾病名、药物名、标签等，可通过 PostgreSQL 的全文检索（tsearch2）实现；同时，将每条文本块的嵌入向量存入 pgvector 列，支持语义相似度检索。检索流程采用混合召回：首先用 BM25 等关键词匹配召回候选，随后用 MiniLM 或 BGE-small 等模型计算查询与记录向量的余弦相似度，再对结果加权融合。此“倒排索引+向量检索”结合的方式，可显著提高命中率和相关性。
在查询时，可对“主题+标签+来源路径”进行多条件过滤（如限制科室、指南类型等）以精细化检索结果。对于高优先级场景（如临床指南咨询），还可引入交互式重排，让用户通过调整相关性反馈进一步筛选证据。
## 5. 回答与引用机制
用户提问后，系统将其转为语义向量并检索知识库，得到若干高相关文档块。系统应输出结构化引用：每段回答引用中包含文献标题、章节编号和原文片段，并标注为可点击标签。最终回答正文由模型生成时引用这些片段进行论证，比如“内科学指南第10章指出‘……’”，确保每个结论都有据可查。用户在界面可点击引用标注，展开查看对应原文节选。此设计保证答案源自权威资料，杜绝无出处的生成，增强可信度。整个问答链路中应记录检索到的证据列表和答案生成内容，形成可审计的决策过程。
## 6. 技术栈与实现选型
后端建议使用Python + FastAPI框架进行服务搭建，结合 PostgreSQL 数据库和 pgvector 插件管理向量数据。FastAPI 性能优越，配合 Kubernetes 部署可将接口响应控制在数百毫秒内。模型推理方面，可选用开源中文大模型 ChatGLM2-6B（量化至 int4）作为生成核心，以及 BAAI 发布的 BGE-small-zh 作为文本嵌入模型，用于检索和向量化。前端可用 Flask 或 Gradio 快速构建界面，支持用户提问和查看引用原文。数据层面，应设计文档版控流程：每导入一次文档即归档一个版本号，关联源文件哈希、更新时间等元信息；增量更新可用独立表记录修改日志，实现数据与答案的一一对应追溯。